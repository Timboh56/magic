.twitter_blaster_container
	%h1 
		= fa_icon "twitter",  text: "Twitter Blaster"
	.row.description
		Use a list of twitter handles separated by commas with a message for the users, or provide a user handle and a message to send to that user's followers.
	- if current_user.nil?
		%div#user_nav
			= link_to "Sign in with Twitter", "/auth/twitter", { class: "btn btn-default" }
	- else
		.row
			.col-xs-12
				%a.btn.btn-default.toggle-btn{ id: "handles", "data-toggle" => ".twitter-blast-form" }
					Twitter blast handles
				%a.btn.btn-default.toggle-btn{ id: "followers", "data-toggle" => ".twitter-blast-form" }
					Twitter blast followers of handle
				%a.btn.btn-default.toggle-btn{ id: "get_followers", "data-toggle" => ".twitter-blast-form" }
					Get followers' handles (no message)	
		.twitter-blast-get-followers-form.twitter-blast-form.hide{ id: "get_followers" }
			= nested_form_for @twitter_blast, { remote: true } do |f|
				= f.hidden_field :blast_type, value: "get_followers"
				.row
					%h1 Get followers of user(s)
				.row
					.col-xs-12
						.col-xs-3
							= f.label "Name?"
						.col-xs-9
							= f.text_field :name
				.row
					.col-xs-12
						.col-xs-3
							%label Twitter handles (separated by commas)
						.col-xs-9
							= f.text_area :twitter_handles
				.row
					= f.button "Get'em!", { type: "submit", class: "btn btn-default blast-btn" }
		.twitter-blast-handles-form.twitter-blast-form.hide{ id: "handles" }
			= nested_form_for @twitter_blast, { remote: true } do |f|
				= f.hidden_field :blast_type, value: "handles"
				.row
					%h1 Tweet to handles
				.row
					.col-xs-12
						.col-xs-3
							= f.label "Name?"
						.col-xs-9
							= f.text_field :name
				.row
					.col-xs-12
						.col-xs-3
							%label Twitter handles (separated by comma or newline)
						.col-xs-9
							= f.text_area :twitter_handles
				.row
					.col-xs-12
						.col-xs-3
							%label Message
						.col-xs-9
							= f.text_area :message
				.row
					.col-xs-12
						= f.button "Blast!", { type: "submit", class: "blast-btn btn btn-default" }
		.twitter-blast-followers-form.twitter-blast-form.hide{ id: "followers"}
			= nested_form_for @twitter_blast, { remote: true } do |f|
				= f.hidden_field :blast_type, value: "followers"
				.row
					%h1
						Tweet to followers
				.row
					.col-xs-12
						.col-xs-3
							= f.label "Name?"
						.col-xs-9
							= f.text_field :name
				.row
					.col-xs-12
						.col-xs-3
							%label Twitter Handle
						.col-xs-9
							= f.text_area :twitter_handles
				.row
					.col-xs-12
						- @handle_lists.each do |hl|
							.col-xs-3
								%label 
									= hl.name
								= f.check_box "handle_list_ids[]", h1.id
				.row
					.col-xs-12
						.col-xs-3
							%label Message
						.col-xs-9
							= f.text_area :message
				.row
					.col-xs-12
						= f.button "Blast!", { type: "submit", class: "blast-btn" }
		.recent-blasts-update
			= render :partial => "twitter_blasts/recent_blasts_table"
:javascript
	$(document).ready( function () {
		var curr_val, blast_btn;

		setInterval(function () {
			$.ajax({
				url: '/twitter_blast/get_blasts',
				type: "GET",
				dataType: "html",
				success: function (xhr) {
					$('.recent-blasts-update').html(xhr);
				}
			});
		}, 5000);

		$('.new_twitter_blast').submit( function (event) {
			var loading_gif = $('<img />').attr('src','#{ image_url "ajax-loader.gif" }');
			blast_btn = $(this).find('.blast-btn');
			curr_val = blast_btn.html();
			blast_btn.html(loading_gif);
		}).on('ajax:complete', function () {
			blast_btn.html(curr_val);
		});

	});